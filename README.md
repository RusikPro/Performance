# Performance

This repository is a collection of benchmarks and performance measurement tools designed to evaluate a variety of CPU-related performance aspects, such as cache behavior, multi-threading, data-oriented design, and more. The repository is structured into modules, each focusing on different performance experiments or patterns.

---

## Modules

### 1. CPU Caches

Located under `cpu_caches/`, this module explores CPU cache behavior, multi-threaded counting techniques, object-oriented vs. data-oriented design, and array size scaling. Key source files include:

- **`parallel_chunks.cpp`**  
  Demonstrates multi-threaded counting of matrix elements above a threshold. Compares false sharing with local counter. Compares two approaches. Generates deterministic or random matrices, runs benchmarks, and outputs results to a CSV file (e.g., `benchmarks_MacOsM1.csv`).

- **`object_data_oriented.cpp`**  
  Compares object-oriented and data-oriented approaches for updating entities in a loop, highlighting potential performance differences in memory access patterns.

- **`oo_benchmark_array_sizes.cpp`**  
  Demonstrates how increasing object sizes (e.g., larger “dummy” arrays in a struct) can affect performance. Uses templated benchmarks to test varying `DummySize` values.

- **`search_benchmarks.cpp`**  
  Evaluates the performance of different search methods (linear, binary, and `std::set`) on a sorted dataset, focusing on how cache locality impacts search times.

- **Additional Utility Headers and Scripts**  
  - **`timer.h`** – A high-resolution timer utility used across the benchmarks.  
  - **`benchmark.hpp`** – Contains generic functions (like `runBenchmark`, `runBenchmarkWithPreCalc`) to measure execution times under various parameters.  
  - **`search_benchmarks.py`**, **`plot_parallel_chunks_results.py`**, **`plot_search_benchmarks.py`**, **`plot_averages.py`**, **`plot_stds.py`** – Python scripts to visualize CSV results.

---

## Building and Running Benchmarks

### Prerequisites

- **C++ Code:**
  - A C++ compiler with C++11 (or later) support.
  - A build system (e.g., CMake or Make) if desired.
  - POSIX threads support (typically included with your compiler).

- **Python Script:**
  - Python 3.x
  - The following Python libraries:
    - `pandas`
    - `matplotlib`

### Building and Running the C++ Benchmark

1. **Compile the Code**

   For example, using `g++` on parallel_chunks.cpp:

   ```bash
   g++ -std=c++20 -O3 -pthread -o parallel_chunks parallel_chunks.cpp
   ```

2. **Run the Benchmark**

   To run the benchmarks, execute the compiled binary with the `benchmark` argument. You can also specify optional parameters:

   ```bash
   ./parallel_chunks benchmark [options]
   ```

   **Options:**
   - `--threads <number>`: Maximum number of threads to test (default: 30)
   - `--rows <number>`: Number of rows in the matrix (default: 1000)
   - `--cols <number>`: Number of columns in the matrix (default: 1000)
   - `--rowscols <number>`: Number of rows and columns in the matrix (default: 1000)
   - `--iterations <number>`: Number of iterations per thread count (default: 5)

   **Example:**

   ```bash
   ./parallel_chunks benchmark --threads 10 --rows 500 --cols 500 --iterations 10
   ```

   The benchmark results will be saved in a CSV file (e.g., `benchmarks_MacOsM1.csv`).

### Running the Python Plotting Tool

1. **Ensure Dependencies are Installed**

   You can install the required libraries using `pip`:

   ```bash
   pip install pandas matplotlib
   ```

2. **Execute the Plotting Script**

   Run the script and provide the path to the CSV file generated by the benchmark:

   ```bash
   python3 plot_parallel_chunks_results.py <path_to_csv_file> [--vertical]
   ```

   **Example:**

   ```bash
   python3 plot_parallel_chunks_results.py benchmarks_MacOsM1.csv
   ```

   Use the `--vertical` flag to arrange the plots vertically instead of side-by-side.

## Repository Structure

```
Performance/
├── cpu_caches/
│   ├── parallel_chunks.cpp
│   ├── object_data_oriented.cpp
│   ├── oo_benchmark_array_sizes.cpp
│   ├── search_benchmarks.cpp
│   ├── timer.h
│   ├── benchmark.hpp
│   ├── plot_parallel_chunks_results.py
│   ├── plot_search_benchmarks.py
│   ├── plot_averages.py
│   ├── plot_stds.py
│   ├── benchmarks_MacOsM1.csv        # Example CSV output
│   └── ...
└── README.md
```

## Future Work

New modules and benchmarks will be added to extend the performance analysis across various aspects of system architecture and multi-threading. Contributions, suggestions, and feedback are welcome!

## Contributing

Contributions to the project are encouraged. To contribute:
1. Fork the repository.
2. Create a feature branch.
3. Commit your changes with clear messages.
4. Open a pull request detailing your modifications.

Please adhere to the coding style.

## License

This project is licensed under the [MIT License](LICENSE).

## Contact

For any questions or suggestions, please open an issue on GitHub or contact the maintainers.
